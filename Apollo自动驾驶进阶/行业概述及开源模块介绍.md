# 行业概述

1. 对于无人驾驶汽车而言，其车载系统信息处理的速度和数量远高于人类。并且，无人驾驶汽车的传感器对车身进行了360度的包裹，避免了视觉盲区。所以，在无人驾驶技术发展成熟的时候，无人驾驶会比人类驾驶更加安全。此外，无人驾驶汽车会对行驶轨迹提前进行规划，并用最高效的方式处理加速减速。引入无人驾驶汽车的道路，拥挤就会减少，可以提高约45%的道路使用率。
2. 事实上，无人驾驶汽车已具备一些自动驾驶的基本元素，比如自动泊车、自适应巡航、车道保持、自动刹车等等。这种形式的"无人驾驶"在未来将会有条件地在部分路段或者高速公路上实现。
3. 等级划分：【入门Driverless overview.md】
   * Level 1是巡航定速（Adaptive Cruise Control），巡航装置可以纵向控制车辆，可以加速减速。
   * Level 2是车道保持辅助（Lane Keeping），系统可以纵向控制也可以横向控制汽车，但车是辅助，人才是主导。
   * Level 3（Lane Change）的定义是：在某一时段内车是责任主体。Level 3的典型代表是奥迪出的最新款A8。A8号称是全球第一款Level 3的无人汽车。
   * level 4相当于全无人驾驶，就是大部分时间由车来做主导。像Waymo、百度新量产的阿波龙无人小巴，就属于level 4级别的无人驾驶车辆。
   * level 5是指驾驶几乎与人类没有关系，level 5的车辆中既没有方向盘也没有脚踏板。

# 开源模块介绍

## 定位技术

> 为了保证无人驾驶车的安全性，当它在路上行驶的时候，必须做到它跟云端是有连接的。无人驾驶车并不需要时时跟云端汇报接下来会如何处理，而是要告诉云端它的位置以及行驶规划。

当然提高无人驾驶车的实现过程，首要的是去对高精度地图进行研究和学习，高精度地图是支持规划、定位和预测等行为的基础。

高精地图相对于导航地图来说，最大的特点就是高精度，它是需要做到车道线级别的。也就是说，高精地图不光要知道你在哪条路上，还需要知道你在这个路的哪条车道线上，因为只有这样才能准确地告诉无人驾驶车应该在哪个车道行驶，接下来应该怎么拐。

1. 高精地图能够给无人车很多预判的空间。当无人车通过高精地图知道前方的路况和交通标识信息后，能够提前做行驶规划，保证了行车的平稳性和经济性。

2. 高精地图能够帮助无人车减少计算量。当无人车需要通过路口时，它需要提前感知前方信号灯的状态，这时高精地图就可以帮助它定位到信号灯所在的特定区域，从而有效降低了全范围扫描识别的计算量。

3. 高精地图将道路及周围的所有静态障碍物进行收集，减少无人车对静态障碍物的算法处理。

就目前来说，我们接触最多的定位方式便是GPS定位，GPS定位原理实际上就是一个相对定位。

卫星会不停地发电磁波，当收到电磁波信号之后，根据收到信号的时间与光速算出和卫星之间的距离。有了与四个卫星的距离之后，就可以解一个方程算出所在位置。

1. 但由于电离层、反射作用等因素的干扰，GPS定位是有误差的，它的精度只能达到米级。对于无人车来说，米级的定位精度是不安全的。
2. GPS定位还有一个问题，它是跳动的。GPS定位是每时每刻根据当前的时间去算的，容易出现计算结果不准的情况。为了抹平GPS的跳变，需要用到IMU（惯性导航），一般来说GPS和IMU是一块用的，GPS不停的去给IMU一个方向去校准，然后IMU再给GPS一个方向。
3. 几何定位的原理和GPS原理差不多，就是在道路上选几个feature，根据这些feature计算无人车所在的位置。几何定位的精度很高，可以精确地算出无人车所在的位置。所以，目前比较流行的定位技术就是GPS、IMU和几何定位等一系列技术的融合。

为了解决无人车定位问题，还需要其他技术。

> 在GPS的基础上发明了RTK技术。手机GPS定位中，手机就是一个移动站，它会经常变动位置。这里所说的RTK，是一个静止站，它同样也收到卫星的信号。无人车与RTK相隔不太远的情况下，对二者之间的干扰信号用差分抹平，就可以认为无人车和RTK收到的信号是一样的。

RTK的应用能让GPS的定位精度达到10厘米【限制：要求基站与车的距离在16公里以内】

## 传感器

无人车想在道路上安全行驶，也必须具备属于它自己的各类传感器去感知外界环境。目前，无人车主要的传感器有摄像头、雷达和激光雷达。

* 摄像头：对于无人车来说，观察信号灯以及一些交通标识都需要对颜色识别。摄像头能够辨别颜色，但是它没有对距离的判断的能力

* 雷达：利用电磁波探测目标的电子设备。雷达发射电磁波对目标进行照射并接收其回波，由此获得目标至电磁波发射点的距离、距离变化率（径向速度）、方位、高度等信息。雷达的应用场景是全天候的，由于电磁波可以饶过一些东西，所以它的准确性并不太高。雷达还有一个特点，它对于速度判断非常准，而对于静态物体的误报比较多。

* 激光雷达：激光雷达工作原理是向目标发射探测信号，然后将接收到的从目标反射回来的信号与发射信号进行比较，作适当处理后，就可获得目标的有关信息。激光雷达的最大优点就是对距离的判断非常精准，但它也有个很大的缺点，就是对环境的要求非常高，比如在雾霾天气里激光雷达的精准度就会降低很多。

|     类型     |             优点             |                     缺点                     |
| :----------: | :--------------------------: | :------------------------------------------: |
| 机械激光雷达 |            易实现            |          机械转动有磨损，且又大又重          |
| 棱镜激光雷达 |     没有机械磨损，价格低     |              车辆抖动会影响精度              |
| flash lidar  | 容易提取，类似拍照，价格便宜 | 距离较近，只能看到五米以内（感觉没有用好吧） |

在无人车收到各种传感器获取的信息之后，还需要做传感器融合。

> 把每个传感器看到的东西全部都叠加在一起。当所有传感器看到的信息综合在一起，无人车才能够更加全面具体地感知外界环境。

有了预测我们就可以做出决策了，也就是规划和控制，

**规划**

* 对于周围的车辆或其他障碍物，无人车是需要避让还是需要停下来，或者需要超越等等，这些都属于约束条件。无人车需要在所有的约束条件中，规划出一条可以走的路线。
* 无人车的轨迹规划
  * 满足所有的约束条件
  * 保证车辆运动的平滑。所谓平滑，是要保证车子的速度不能跳变
  * 在此基础上，车子的加速度也需要是平滑的
  * 在人类可感知的范围，车子行驶是顺畅的，没有不平滑不顺的情况

**控制**

我们需要知道踩刹车和减速的关系、踩油门和加速的关系等，当无人车拿到一些控制学参数后，就可以实现电脑对无人车的控制。

## 无人车的安全问题

> 自动驾驶的核心问题：安全性

> ISO-26262是一个非常复杂、非常结构化的标准。比如说，如果一个硬件达到了ASIL D级别的要求，那么它的故障率是10 fit（Failures In Time, in one billion device-hours of operation），即10亿个小时里面出一次故障。从英文来讲，安全有两个词：Safety和Security。
>
> * ISO-26262是一个行业规范而不是一个例法，只覆盖Safety，不覆盖Security。但我们在做无人驾驶的时候，必须考虑security。
> * 通过ISO-26262的认证是一个特别慎重的流程。

Safety包含两个方面：系统性故障 Systematic Faults 和随机故障 Random Faults

1. 系统性故障是说，我在设计汽车的时候就存在的缺陷。每次运行的时候，都一定会发现问题。软件和硬件都有可能存在系统性故障。

2. 随机故障是由不可控的因素造成的故障，不一定会出现，比如路上颠簸了一下。一般情况下，只有硬件会出现随机故障。

Security涉及的不是车自身的问题，而是系统被别人攻占了。以前你要攻陷一辆车，是很困难的事情，没有物理连接也没有网络连接。但是有了无人驾驶技术以后，车总是和网络相连，让车变得特别容易被攻击。

针对安全问题的分析，我们需要一些前验认知：

1. 明确车具备哪些功能以及这些功能由哪些零部件完成
2. 考虑对于车的每个功能是否会出现故障，一旦出现问题是什么级别的问题

### 判断、认证标准

ISO-26262给了三个判断标准：Exposure、Controllable、Separately，以在具体情境中判断某一问题的严重性。

* Separately是指车和人分离，出事故后有多少概率会造成人员伤亡。

* Exposure是指这件事情是否常见。

* Controllable是指车出现了问题，驾驶员是否有机会接管。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200814064240933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Jva29CYXNpbGlzaw==,size_16,color_FFFFFF,t_70#pic_center)

ISO-26262的认证过程是一个“V型”：

1. 是什么开发环境；
2. 分析问题的等级是怎么样；
   * 如果是一个很高的等级需要判断这个问题出现的概率有多大。
3. 这个问题具体要怎么解决；
   * 先做High Level层级的，再到Function层级，然后到Technique层级。
   * Technique层级涉及软件和硬件。软件硬件确保了安全性后，再返回往上去做验证。对于ISO-26262更高级别的要求，它会要求有很多Redundant system。如果现行的系统坏了，下面还有一套系统。如果出现问题，另外这个系统具备使它停下来的机制。

ISO是一个汽车行业的标杆，他有很多好处。

* 告诉了汽车行业制造商什么是安全的标准；
* 提高了汽车安全性能的监管机制；
* 打官司时有评判标准。

## 技术架构

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020081406472776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Jva29CYXNpbGlzaw==,size_16,color_FFFFFF,t_70#pic_center)

百度Apollo的技术框架包括四层：

1. 线控车辆平台（Reference Vehicle Platform）
   * 所有的东西都需要装载在线控车辆上才可以跑起来
2. 参考硬件平台（Reference Hardware Platform）
   * 包含一个计算平台（computing unit）用于计算传感器传递的各类信息以及各种传感器
   * 包括用于人机交互的HMI Device和用于记录信息、技术迭代的黑匣子
3. 软件开放平台（Open Software Platform）
   * 开源，实际是在一个实时操作系统上运行，可以看作一个操作系统的底层框架加一个消息的分发机制。软件开放平台还包括map engine，定位、感知、规划、控制等技术模块
4. 云端服务平台（Cloud Service Platform）
   * 车在路上跑需要和云端有一定的交互，云端计算出模型再把它下发到车上

### 多环境自动驾驶

1. Apollo 1.0 循迹自动驾驶
   * 所谓循迹自动驾驶就是人开一段，然后车记录下人开的轨迹，再沿着这个轨迹不停的回放。典型的代表是农用机器人——阿波牛。在Apollo 1.0里不需要camera，也不需要Sensor，只需要一个GPS。也不需要做规划，有精准的定位就行。
2. Apollo 1.5 固定车道自动驾驶
   * 固定车道自动驾驶，就是指在不变道的情况下处理一个车道内的所有行为，比如跟车、在车道内行进等。
   * 到1.5版本时我们做了很多技术进步，加上了Lidar、Map、Perception、Planning等。如为老年人或残障人士设计的漫步车。
3. Apollo 2.0 简单城市道路自动驾驶
   * Apollo 2.0 几乎把所有的模块都点亮了，我们加入了Camera、Radar、Security、OTA等。

> 到Apollo 2.5版本的时候，Apollo已经成长为全球最大最活跃的无人驾驶社区了。

> Apollo 3.0对我们来说是一个里程碑式的进步，因为加入了量产解决方案。

Apollo 3.0相当于迈出了商业应用的一步。虽然场景只限定在园区内，但自动接驳小巴、自主泊车这些确实都是通过量产的方式进行的。

Apollo 3.0我们除了量产解决方案之外，同时还发布了量产安全套件、量产解决方案套件，可以让开发者自行配置。同时我们把硬件开发平台和车辆运行平台进行了升级，只要符合要求都可以进入。这样接入Apollo的成本会大大降低，开发者也会有更多的选择。