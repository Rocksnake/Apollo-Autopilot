> 控制是驱使车辆前行的策略，对于汽车而言 最基本的控制输入为转向、加速和制动
>
> * 控制器使用一系列路径点来接收轨迹
> * 控制器的任务是使用控制输入让车辆通过这些路径点的

**控制策略:**

1. 比例积分微分控制(或PID)
2. 线性二次调节器(或LQR)
3. 模型预测控制(或MPC)

**控制流程**

控制器输入有两种：目标轨迹和车辆状态。前者来自规划模块，在每个点上，指定一个位置和参考速度。后者是本地化模块来计算车辆位置、从车辆内部传感器获取的数据（速度、转向和加速度）。我们使用这两个输入来计算目标轨迹与实际行进轨迹之间的偏差。

控制器的输出是，控制输入（转向、加速和制动）的值，当偏离目标轨迹时，我们希望通过采取行动来纠正这种偏差。

**PID控制**

> PID控制器只是一种线性算法，
>
> * 对于非常复杂的系统而言这是不够的，我们需要应用不同的PID控制器来控制转向和加速，这意味着很难将横向和纵向控制结合起来
> * PID控制器依赖于实时误差测量，这意味着受到测量延迟限制时可能会失效

> 结构简单，只需知道与目标轨迹有多大的偏离

1. PID的第一个组件为P代表“比例”(proportional)，设想一辆车正试图遵循目标轨迹，P控制器在车辆开始偏离时，立即将其拉回目标轨迹，
   * 比例控制意味着车辆偏离越远，控制器就越难将其拉回目标轨迹
   * 在实践中P控制器的一个问题在于，它很容易超出参考轨迹，当车辆越来越接近目标轨迹时，我们需要控制器更加稳定

2. PID控制器中的D项致力于使运动处于稳定状态，D代表“微分”，
   * PD控制器类似于P控制器，它增加了一个阻尼项，可最大限度地减少控制器输出的变化速
3. PID控制器中的最后一项I表示积分，该项负责纠正车辆的任何系统性偏差

**线性二次调节器（或LQR）**

> 是基于模型的控制器，它使用车辆的状态来使误差最小化

用LQR进行横向控制，横向控制包含四个组件

横向误差，横向误差的变化率，朝向误差，和朝向的变化率，变化率与导数相同。称这四个组件的集合为X，这个集合X捕获车辆的状态。

除了状态之外，该车有三个控制输入：转向、加速和制动，控制输入集合称为U

X(上方带点)=Ax+Bu，X(上方带点)向量是导数，或x向量的变化率，所以x点的每个分量只是x相应分量的导数。等式x点=Ax+Bu，该等式捕捉状态里的变化，即x点 是如何受当前状态x，和控制输入u的影响的。

**模型预测控制（或MPC）**

> 是一种更复杂的控制器它非常依赖于数学优化，但基本上可以将MPC归结为三个步骤
>
> 1. 建立车辆模型，MPC的第一步为定义车辆模型，该模型近似于汽车的物理特性
> 2. 使用优化引擎计算有限时间范围内的控制输入，即MPC预测未来的能力，预测越深入，控制器就越精确，不过需要的时间也越长，所以我们需要在准确度与快速获取结果之间做出取舍，获取结果的速度越快，越能快速地将控制输入应用到实际车辆中
> 3. 执行第一组控制输入，将模型发送到搜索最佳控制输入的优化引擎，该优化引擎的工作原理，是通过搜索密集数学空间来寻求最佳解决方案，为缩小搜索范围，优化引擎依赖于车辆模型的约束条件

优化引擎可间接评估控制输入，是通过使用这些方法对车辆轨迹进行建模的，可根据成本函数对轨迹进行评估，成本函数主要基于与目标轨迹的偏差，其次基于其他因素如加速度，和提升乘客舒适度的措施，为使乘客感觉更舒适，对控制输入的调整应该很小，因为动作变化幅度过大会让乘客感到不舒服。

模型预测控制考虑了车辆模型，因此比PID控制更精确，它也适用于不同的成本函数，所以我们可以在不同情况下优化不同的成本，另一方面与PID控制相比，模型预测控制相对更复杂、更缓慢、更难以实现。

根据具体情况，我们可能需要为其考虑进一步的成本，并设计成本函数。模型、约束和成本函数合并在一起，并作为优化问题加以解决。我们可以在不同的优化引擎中，选择一种来寻找最佳解决方案。